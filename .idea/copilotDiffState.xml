<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/noponto/data/repository/OcorrenciaRepository.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/noponto/data/repository/OcorrenciaRepository.kt" />
              <option name="originalContent" value="package com.example.noponto.data.repository&#10;&#10;import com.example.noponto.domain.model.Ocorrencia&#10;import com.example.noponto.domain.repository.IOcorrenciaRepository&#10;import com.google.android.gms.tasks.Task&#10;import com.google.firebase.Timestamp&#10;import com.google.firebase.firestore.DocumentSnapshot&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import com.google.firebase.firestore.Query&#10;import kotlinx.coroutines.suspendCancellableCoroutine&#10;import kotlin.coroutines.resume&#10;import kotlin.coroutines.resumeWithException&#10;&#10;class OcorrenciaRepository(&#10;    private val db: FirebaseFirestore = FirebaseFirestore.getInstance()&#10;) : IOcorrenciaRepository {&#10;&#10;    private suspend fun &lt;T&gt; Task&lt;T&gt;.await(): T = suspendCancellableCoroutine { cont -&gt;&#10;        addOnSuccessListener { result -&gt; cont.resume(result) }&#10;        addOnFailureListener { exc -&gt; if (!cont.isCompleted) cont.resumeWithException(exc) }&#10;        addOnCanceledListener { if (!cont.isCompleted) cont.cancel() }&#10;    }&#10;&#10;    private suspend fun Task&lt;Void&gt;.awaitVoid(): Unit = suspendCancellableCoroutine { cont -&gt;&#10;        addOnSuccessListener { cont.resume(Unit) }&#10;        addOnFailureListener { exc -&gt; if (!cont.isCompleted) cont.resumeWithException(exc) }&#10;        addOnCanceledListener { if (!cont.isCompleted) cont.cancel() }&#10;    }&#10;&#10;    private fun docToOcorrencia(doc: DocumentSnapshot): Ocorrencia? {&#10;        val data = doc.data ?: return null&#10;        try {&#10;            val id = doc.getString(&quot;id&quot;) ?: doc.id&#10;            val funcionarioRef = doc.getDocumentReference(&quot;funcionarioRef&quot;)&#10;            val funcionarioId = doc.getString(&quot;funcionarioId&quot;) ?: &quot;&quot;&#10;            val funcionarioNome = doc.getString(&quot;funcionarioNome&quot;) ?: &quot;&quot;&#10;            val justificativa = doc.getString(&quot;justificativa&quot;) ?: &quot;&quot;&#10;            val dataHora = doc.getTimestamp(&quot;dataHora&quot;)&#10;            val hasAtestado = doc.getBoolean(&quot;hasAtestado&quot;) ?: false&#10;            val atestadoStoragePath = doc.getString(&quot;atestadoStoragePath&quot;)&#10;            val statusStr = doc.getString(&quot;status&quot;) ?: Ocorrencia.StatusOcorrencia.PENDENTE.name&#10;            val status = try { Ocorrencia.StatusOcorrencia.valueOf(statusStr) } catch (e: Exception) { Ocorrencia.StatusOcorrencia.PENDENTE }&#10;            val criadoEm = doc.getTimestamp(&quot;criadoEm&quot;)&#10;&#10;            return Ocorrencia(&#10;                id = id,&#10;                funcionarioRef = funcionarioRef,&#10;                funcionarioId = funcionarioId,&#10;                funcionarioNome = funcionarioNome,&#10;                justificativa = justificativa,&#10;                dataHora = dataHora,&#10;                hasAtestado = hasAtestado,&#10;                atestadoStoragePath = atestadoStoragePath,&#10;                status = status,&#10;                criadoEm = criadoEm&#10;            )&#10;        } catch (e: Exception) {&#10;            return null&#10;        }&#10;    }&#10;&#10;    override suspend fun salvarOcorrencia(ocorrencia: Ocorrencia): Result&lt;String&gt; {&#10;        return try {&#10;            val docRef = db.collection(&quot;ocorrencias&quot;).document()&#10;            val id = docRef.id&#10;            val toSave = mapOf(&#10;                &quot;id&quot; to id,&#10;                &quot;funcionarioRef&quot; to ocorrencia.funcionarioRef,&#10;                &quot;funcionarioId&quot; to ocorrencia.funcionarioId,&#10;                &quot;funcionarioNome&quot; to ocorrencia.funcionarioNome,&#10;                &quot;justificativa&quot; to ocorrencia.justificativa,&#10;                &quot;dataHora&quot; to (ocorrencia.dataHora ?: Timestamp.now()),&#10;                &quot;hasAtestado&quot; to ocorrencia.hasAtestado,&#10;                &quot;atestadoStoragePath&quot; to ocorrencia.atestadoStoragePath,&#10;                &quot;status&quot; to (ocorrencia.status?.name ?: Ocorrencia.StatusOcorrencia.PENDENTE.name),&#10;                &quot;criadoEm&quot; to (ocorrencia.criadoEm ?: Timestamp.now())&#10;            )&#10;            docRef.set(toSave).awaitVoid()&#10;            Result.success(id)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    override suspend fun atualizarOcorrencia(ocorrencia: Ocorrencia): Result&lt;Unit&gt; {&#10;        return try {&#10;            if (ocorrencia.id.isBlank()) return Result.failure(IllegalArgumentException(&quot;ocorrencia.id is blank&quot;))&#10;            val docRef = db.collection(&quot;ocorrencias&quot;).document(ocorrencia.id)&#10;            val toSave = mapOf(&#10;                &quot;funcionarioRef&quot; to ocorrencia.funcionarioRef,&#10;                &quot;funcionarioId&quot; to ocorrencia.funcionarioId,&#10;                &quot;funcionarioNome&quot; to ocorrencia.funcionarioNome,&#10;                &quot;justificativa&quot; to ocorrencia.justificativa,&#10;                &quot;dataHora&quot; to (ocorrencia.dataHora ?: Timestamp.now()),&#10;                &quot;hasAtestado&quot; to ocorrencia.hasAtestado,&#10;                &quot;atestadoStoragePath&quot; to ocorrencia.atestadoStoragePath,&#10;                &quot;status&quot; to (ocorrencia.status?.name ?: Ocorrencia.StatusOcorrencia.PENDENTE.name),&#10;                &quot;criadoEm&quot; to (ocorrencia.criadoEm ?: Timestamp.now())&#10;            )&#10;            docRef.set(toSave).awaitVoid()&#10;            Result.success(Unit)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    override suspend fun removerOcorrencia(ocorrenciaId: String): Result&lt;Unit&gt; {&#10;        return try {&#10;            if (ocorrenciaId.isBlank()) return Result.failure(IllegalArgumentException(&quot;ocorrenciaId is blank&quot;))&#10;            db.collection(&quot;ocorrencias&quot;).document(ocorrenciaId).delete().awaitVoid()&#10;            Result.success(Unit)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    override suspend fun buscarOcorrenciaPorId(ocorrenciaId: String): Result&lt;Ocorrencia?&gt; {&#10;        return try {&#10;            if (ocorrenciaId.isBlank()) return Result.success(null)&#10;            val snap = db.collection(&quot;ocorrencias&quot;).document(ocorrenciaId).get().await()&#10;            val occ = docToOcorrencia(snap)&#10;            Result.success(occ)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    override suspend fun listarOcorrenciasDoFuncionario(funcionarioId: String, limit: Int): Result&lt;List&lt;Ocorrencia&gt;&gt; {&#10;        return try {&#10;            val query = db.collection(&quot;ocorrencias&quot;)&#10;                .whereEqualTo(&quot;funcionarioId&quot;, funcionarioId)&#10;                .orderBy(&quot;criadoEm&quot;, Query.Direction.DESCENDING)&#10;                .limit(limit.toLong())&#10;            val snap = query.get().await()&#10;            val list = snap.documents.mapNotNull { docToOcorrencia(it) }&#10;            Result.success(list)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    override suspend fun listarPorStatus(status: Ocorrencia.StatusOcorrencia, limit: Int): Result&lt;List&lt;Ocorrencia&gt;&gt; {&#10;        return try {&#10;            val query = db.collection(&quot;ocorrencias&quot;)&#10;                .whereEqualTo(&quot;status&quot;, status.name)&#10;                .orderBy(&quot;criadoEm&quot;, Query.Direction.DESCENDING)&#10;                .limit(limit.toLong())&#10;            val snap = query.get().await()&#10;            val list = snap.documents.mapNotNull { docToOcorrencia(it) }&#10;            Result.success(list)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    override suspend fun setStatus(ocorrenciaId: String, status: Ocorrencia.StatusOcorrencia): Result&lt;Unit&gt; {&#10;        return try {&#10;            if (ocorrenciaId.isBlank()) return Result.failure(IllegalArgumentException(&quot;ocorrenciaId is blank&quot;))&#10;            db.collection(&quot;ocorrencias&quot;).document(ocorrenciaId).update(mapOf(&quot;status&quot; to status.name)).awaitVoid()&#10;            Result.success(Unit)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;&#10;    override suspend fun buscarUltimasOcorrencias(funcionarioId: String, limit: Int): Result&lt;List&lt;Ocorrencia&gt;&gt; {&#10;        return try {&#10;            val query = db.collection(&quot;ocorrencias&quot;)&#10;                .whereEqualTo(&quot;funcionarioId&quot;, funcionarioId)&#10;                .orderBy(&quot;criadoEm&quot;, Query.Direction.DESCENDING)&#10;                .limit(limit.toLong())&#10;            val snap = query.get().await()&#10;            val list = snap.documents.mapNotNull { docToOcorrencia(it) }&#10;            Result.success(list)&#10;        } catch (e: Exception) {&#10;            Result.failure(e)&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.noponto.data.repository&#10;&#10;import com.example.noponto.domain.model.Ocorrencia&#10;import com.example.noponto.domain.repository.IOcorrenciaRepository&#10;import com.google.android.gms.tasks.Task&#10;import com.google.firebase.Timestamp&#10;import com.google.firebase.firestore.DocumentSnapshot&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import com.google.firebase.firestore.Query&#10;import kotlinx.coroutines.suspendCancellableCoroutine&#10;import kotlin.coroutines.resume&#10;import kotlin.coroutines.resumeWithException&#10;&#10;class OcorrenciaRepository(&#10;    private val db: FirebaseFirestore = FirebaseFirestore.getInstance()&#10;) : IOcorrenciaRepository {&#10;&#10;    private suspend fun &lt;T&gt; Task&lt;T&gt;.await(): T = suspendCancellableCoroutine { cont -&gt;&#10;        addOnSuccessListener { result -&gt; cont.resume(result) }&#10;        addOnFailureListener { exc -&gt; if (!cont.isCompleted) cont.resumeWithException(exc) }&#10;        addOnCanceledListener { if (!cont.isCompleted) cont.cancel() }&#10;    }&#10;&#10;    private suspend fun Task&lt;Void&gt;.awaitVoid(): Unit = suspendCancellableCoroutine { cont -&gt;&#10;        addOnSuccessListener { cont.resume(Unit) }&#10;        addOnFailureListener { exc -&gt; if (!cont.isCompleted) cont.resumeWithException(exc) }&#10;        addOnCanceledListener { if (!cont.isCompleted) cont.cancel() }&#10;    }&#10;&#10;    private fun docToOcorrencia(doc: DocumentSnapshot): Ocorrencia? {&#10;        if (doc.data == null) return null&#10;        try {&#10;            val id = doc.getString(&quot;id&quot;) ?: doc.id&#10;            val funcionarioRef = doc.getDocumentReference(&quot;funcionarioRef&quot;)&#10;            val funcionarioId = doc.getString(&quot;funcionarioId&quot;) ?: &quot;&quot;&#10;            val funcionarioNome = doc.getString(&quot;funcionarioNome&quot;) ?: &quot;&quot;&#10;            val justificativa = doc.getString(&quot;justificativa&quot;) ?: &quot;&quot;&#10;            val dataHora = doc.getTimestamp(&quot;dataHora&quot;)&#10;            val hasAtestado = doc.getBoolean(&quot;hasAtestado&quot;) ?: false&#10;            val atestadoStoragePath = doc.getString(&quot;atestadoStoragePath&quot;)&#10;            val statusStr = doc.getString(&quot;status&quot;) ?: Ocorrencia.StatusOcorrencia.PENDENTE.name&#10;            val status = try { Ocorrencia.StatusOcorrencia.valueOf(statusStr) } catch (_: Exception) { Ocorrencia.StatusOcorrencia.PENDENTE }&#10;            val criadoEm = doc.getTimestamp(&quot;criadoEm&quot;)&#10;&#10;            return Ocorrencia(&#10;                id = id,&#10;                funcionarioRef = funcionarioRef,&#10;                funcionarioId = funcionarioId,&#10;                funcionarioNome = funcionarioNome,&#10;                justificativa = justificativa,&#10;                dataHora = dataHora,&#10;                hasAtestado = hasAtestado,&#10;                atestadoStoragePath = atestadoStoragePath,&#10;                status = status,&#10;                criadoEm = criadoEm&#10;            )&#10;        } catch (_: Exception) {&#10;            return null&#10;        }&#10;    }&#10;&#10;    override suspend fun salvarOcorrencia(ocorrencia: Ocorrencia): Result&lt;String&gt; {&#10;        return try {&#10;            val docRef = db.collection(&quot;ocorrencias&quot;).document()&#10;            val id = docRef.id&#10;            val toSave = mapOf(&#10;                &quot;id&quot; to id,&#10;                &quot;funcionarioRef&quot; to ocorrencia.funcionarioRef,&#10;                &quot;funcionarioId&quot; to ocorrencia.funcionarioId,&#10;                &quot;funcionarioNome&quot; to ocorrencia.funcionarioNome,&#10;                &quot;justificativa&quot; to ocorrencia.justificativa,&#10;                &quot;dataHora&quot; to (ocorrencia.dataHora ?: Timestamp.now()),&#10;                &quot;hasAtestado&quot; to ocorrencia.hasAtestado,&#10;                &quot;atestadoStoragePath&quot; to ocorrencia.atestadoStoragePath,&#10;                &quot;status&quot; to (ocorrencia.status.name ?: Ocorrencia.StatusOcorrencia.PENDENTE.name),&#10;                &quot;criadoEm&quot; to (ocorrencia.criadoEm ?: Timestamp.now())&#10;            )&#10;            docRef.set(toSave).awaitVoid()&#10;            Result.success(id)&#10;        } catch (_: Exception) {&#10;            Result.failure(Exception(&quot;Falha ao salvar ocorrência&quot;))&#10;        }&#10;    }&#10;&#10;    override suspend fun atualizarOcorrencia(ocorrencia: Ocorrencia): Result&lt;Unit&gt; {&#10;        return try {&#10;            if (ocorrencia.id.isBlank()) return Result.failure(IllegalArgumentException(&quot;ocorrencia.id is blank&quot;))&#10;            val docRef = db.collection(&quot;ocorrencias&quot;).document(ocorrencia.id)&#10;            val toSave = mapOf(&#10;                &quot;funcionarioRef&quot; to ocorrencia.funcionarioRef,&#10;                &quot;funcionarioId&quot; to ocorrencia.funcionarioId,&#10;                &quot;funcionarioNome&quot; to ocorrencia.funcionarioNome,&#10;                &quot;justificativa&quot; to ocorrencia.justificativa,&#10;                &quot;dataHora&quot; to (ocorrencia.dataHora ?: Timestamp.now()),&#10;                &quot;hasAtestado&quot; to ocorrencia.hasAtestado,&#10;                &quot;atestadoStoragePath&quot; to ocorrencia.atestadoStoragePath,&#10;                &quot;status&quot; to (ocorrencia.status.name ?: Ocorrencia.StatusOcorrencia.PENDENTE.name),&#10;                &quot;criadoEm&quot; to (ocorrencia.criadoEm ?: Timestamp.now())&#10;            )&#10;            docRef.set(toSave).awaitVoid()&#10;            Result.success(Unit)&#10;        } catch (_: Exception) {&#10;            Result.failure(Exception(&quot;Falha ao atualizar ocorrência&quot;))&#10;        }&#10;    }&#10;&#10;    override suspend fun removerOcorrencia(ocorrenciaId: String): Result&lt;Unit&gt; {&#10;        return try {&#10;            if (ocorrenciaId.isBlank()) return Result.failure(IllegalArgumentException(&quot;ocorrenciaId is blank&quot;))&#10;            db.collection(&quot;ocorrencias&quot;).document(ocorrenciaId).delete().awaitVoid()&#10;            Result.success(Unit)&#10;        } catch (_: Exception) {&#10;            Result.failure(Exception(&quot;Falha ao remover ocorrência&quot;))&#10;        }&#10;    }&#10;&#10;    override suspend fun buscarOcorrenciaPorId(ocorrenciaId: String): Result&lt;Ocorrencia?&gt; {&#10;        return try {&#10;            if (ocorrenciaId.isBlank()) return Result.success(null)&#10;            val snap = db.collection(&quot;ocorrencias&quot;).document(ocorrenciaId).get().await()&#10;            val occ = docToOcorrencia(snap)&#10;            Result.success(occ)&#10;        } catch (_: Exception) {&#10;            Result.failure(Exception(&quot;Falha ao buscar ocorrência&quot;))&#10;        }&#10;    }&#10;&#10;    override suspend fun listarOcorrenciasDoFuncionario(funcionarioId: String, limit: Int): Result&lt;List&lt;Ocorrencia&gt;&gt; {&#10;        return try {&#10;            val query = db.collection(&quot;ocorrencias&quot;)&#10;                .whereEqualTo(&quot;funcionarioId&quot;, funcionarioId)&#10;                .orderBy(&quot;criadoEm&quot;, Query.Direction.DESCENDING)&#10;                .limit(limit.toLong())&#10;            val snap = query.get().await()&#10;            val list = snap.documents.mapNotNull { docToOcorrencia(it) }&#10;            Result.success(list)&#10;        } catch (_: Exception) {&#10;            Result.failure(Exception(&quot;Falha ao listar ocorrências&quot;))&#10;        }&#10;    }&#10;&#10;    override suspend fun listarPorStatus(status: Ocorrencia.StatusOcorrencia, limit: Int): Result&lt;List&lt;Ocorrencia&gt;&gt; {&#10;        return try {&#10;            val query = db.collection(&quot;ocorrencias&quot;)&#10;                .whereEqualTo(&quot;status&quot;, status.name)&#10;                .orderBy(&quot;criadoEm&quot;, Query.Direction.DESCENDING)&#10;                .limit(limit.toLong())&#10;            val snap = query.get().await()&#10;            val list = snap.documents.mapNotNull { docToOcorrencia(it) }&#10;            Result.success(list)&#10;        } catch (_: Exception) {&#10;            Result.failure(Exception(&quot;Falha ao listar ocorrências por status&quot;))&#10;        }&#10;    }&#10;&#10;    override suspend fun setStatus(ocorrenciaId: String, status: Ocorrencia.StatusOcorrencia): Result&lt;Unit&gt; {&#10;        return try {&#10;            if (ocorrenciaId.isBlank()) return Result.failure(IllegalArgumentException(&quot;ocorrenciaId is blank&quot;))&#10;            db.collection(&quot;ocorrencias&quot;).document(ocorrenciaId).update(mapOf(&quot;status&quot; to status.name)).awaitVoid()&#10;            Result.success(Unit)&#10;        } catch (_: Exception) {&#10;            Result.failure(Exception(&quot;Falha ao atualizar status&quot;))&#10;        }&#10;    }&#10;&#10;    override suspend fun buscarUltimasOcorrencias(funcionarioId: String, limit: Int): Result&lt;List&lt;Ocorrencia&gt;&gt; {&#10;        return try {&#10;            val query = db.collection(&quot;ocorrencias&quot;)&#10;                .whereEqualTo(&quot;funcionarioId&quot;, funcionarioId)&#10;                .orderBy(&quot;criadoEm&quot;, Query.Direction.DESCENDING)&#10;                .limit(limit.toLong())&#10;            val snap = query.get().await()&#10;            val list = snap.documents.mapNotNull { docToOcorrencia(it) }&#10;            Result.success(list)&#10;        } catch (_: Exception) {&#10;            Result.failure(Exception(&quot;Falha ao buscar últimas ocorrências&quot;))&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>